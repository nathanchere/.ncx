#!/bin/bash

# Note: if calling from terminator/etc you'll need to
# run as `logout &` or the script will abort when
# the host terminal is closed

waitForAllTerminated() {
  end=$(($SECONDS+$1))
  while [ $SECONDS -lt $end ]; do
    if [[ -z `wmctrl -l` ]]; then
      return 0;
    fi
    sleep .05
  done
  return -1
}

for win in $(wmctrl -l | awk '{print $1}'); do
  wmctrl -ic $win
done

waitForAllTerminated 5

if [[ $? != 0 ]]; then
  notify-send -u critical "Cannot quit" "One or more windows cannot be closed"
  exit -1
fi

pkill xmonad
